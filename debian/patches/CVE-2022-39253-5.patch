Backported of:

From f8d510ed0b357787c8d035d64f240bd82b424dc4 Mon Sep 17 00:00:00 2001
From: Taylor Blau <me@ttaylorr.com>
Date: Fri, 29 Jul 2022 15:20:28 -0400
Subject: [PATCH 05/15] t/t3NNN: allow local submodules

To prepare for the default value of `protocol.file.allow` to change to
"user", ensure tests that rely on local submodules can initialize them
over the file protocol.

Tests that only need to interact with submodules in a limited capacity
have individual Git commands annotated with the appropriate
configuration via `-c`. Tests that interact with submodules a handful of
times use `test_config_global` instead. Test scripts that rely on
submodules throughout use a `git config --global` during a setup test
towards the beginning of the script.

Signed-off-by: Taylor Blau <me@ttaylorr.com>
--- a/t/t3600-rm.sh
+++ b/t/t3600-rm.sh
@@ -295,6 +295,7 @@ test_expect_success 'rm removes empty su
 
 test_expect_success 'rm removes removed submodule from index and .gitmodules' '
 	git reset --hard &&
+	test_config_global protocol.file.allow always &&
 	git submodule update &&
 	rm -rf submod &&
 	git rm submod &&
@@ -612,6 +612,7 @@ cat >expect.deepmodified <<EOF
 EOF
 
 test_expect_success 'setup subsubmodule' '
+	test_config_global protocol.file.allow always &&
 	git reset --hard &&
 	git submodule update &&
 	(cd submod &&
